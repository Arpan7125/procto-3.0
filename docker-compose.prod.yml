version: "3.9"

# ============================================================
#  PROCTO â€” Docker Compose PRODUCTION overrides
#  Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up
#
#  This file ONLY contains overrides from the base docker-compose.yml.
#  It switches to production builds and removes volume mounts.
# ============================================================

services:

  postgres:
    restart: always
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    # In production, do NOT expose postgres port publicly
    ports: []

  redis:
    restart: always
    # In production, do NOT expose redis port publicly
    ports: []

  backend:
    build:
      target: production # uses the production stage in Dockerfile
    restart: always
    environment:
      NODE_ENV: production
    volumes: [] # no source code mounts in production
    command: node dist/server.js

  frontend:
    build:
      target: production # builds with nginx
      args:
        VITE_API_URL: ${VITE_API_URL}
        VITE_WS_URL: ${VITE_WS_URL}
    restart: always
    ports:
      - "80:80"
    volumes: []
    command: [] # nginx uses its own CMD
